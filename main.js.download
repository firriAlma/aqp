AUI.add("liferay-portlet-dynamic-data-lists",function(f){var e=f.Array;var g=f.DataType.DateMath;var h=f.Lang;var d=f.Lang.emptyFn;var l=f.JSON;var m="-";var j="";var c=" ";var i=f.Component.create({NAME:"document-library-file-entry-cell-editor",EXTENDS:f.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<input type="hidden" />',initializer:function(){var n=this;window[Liferay.Util.getPortletNamespace("166")+"selectDocumentLibrary"]=f.bind("_selectFileEntry",n)},getElementsValue:function(){var n=this;return n.get("value")},_defInitToolbarFn:function(){var n=this;i.superclass._defInitToolbarFn.apply(n,arguments);n.toolbar.add({on:{click:f.bind("_onClickChoose",n)},label:'\u0053\u0063\u0065\u0067\u006c\u0069'},1)},_onClickChoose:function(){var n=this;var o=Liferay.PortletURL.createURL(themeDisplay.getURLControlPanel());o.setParameter("groupId",themeDisplay.getScopeGroupId());o.setParameter("struts_action","/dynamic_data_mapping/select_document_library");o.setPortletId("166");o.setWindowState("pop_up");Liferay.Util.openWindow({id:"selectDocumentLibrary",title:'\u0044\u006f\u0063\u0075\u006d\u0065\u006e\u0074\u0069\u0020\u0065\u0020\u004d\u0065\u0064\u0069\u0061',uri:o.toString()})},_selectFileEntry:function(p,r,q,s,o){var n=this;n.selectedTitle=s;n.selectedURL=p;n.set("value",l.stringify({groupId:q,title:s,uuid:r,version:o}))},_syncFileLabel:function(r,q){var n=this;var p=n.get("contentBox");var o=p.one("a");if(!o){o=f.Node.create("<a></a>");p.prepend(o)}o.setAttribute("href",q);o.setContent(Liferay.Util.escapeHTML(r))},_uiSetValue:function(q){var n=this;if(q){var p=n.selectedTitle;var o=n.selectedURL;if(p&&o){n._syncFileLabel(p,o)}else{b.Util.getFileEntry(q,function(s){var r=b.Util.getFileEntryURL(s);n._syncFileLabel(s.title,r)})}}else{n._syncFileLabel(j,j);q=j}n.elements.val(q)}}});var k=f.Component.create({NAME:"link-to-page-cell-editor",EXTENDS:f.DropDownCellEditor,prototype:{OPT_GROUP_TEMPLATE:'<optgroup label="{label}">{options}</optgroup>',renderUI:function(p){var n=this;var o={};k.superclass.renderUI.apply(n,arguments);f.io.request(themeDisplay.getPathMain()+"/layouts_admin/get_layouts",{after:{success:function(){var q=f.JSON.parse(this.get("responseData"));if(q&&q.layouts){n._createOptionElements(q.layouts,o,j);n.set("options",o)}}},data:{cmd:"getAll",expandParentLayouts:true,groupId:themeDisplay.getScopeGroupId(),p_auth:Liferay.authToken,paginate:false}})},_createOptions:function(u){var n=this;var r=[];var o=[];f.each(u,function(y,x,z){var v={id:f.guid(),label:x,value:Liferay.Util.escapeHTML(l.stringify(y))};var w=o;if(y.privateLayout){w=r}w.push(h.sub(n.OPTION_TEMPLATE,v))});var p=n.OPT_GROUP_TEMPLATE;var t=h.sub(p,{label:'\u0050\u0061\u0067\u0069\u006e\u0065\u0020\u0050\u0075\u0062\u0062\u006c\u0069\u0063\u0068\u0065',options:o.join(j)});var q=h.sub(p,{label:'\u0050\u0061\u0067\u0069\u006e\u0065\u0020\u0050\u0072\u0069\u0076\u0061\u0074\u0065',options:r.join(j)});var s=n.elements;s.setContent(t+q);n.options=s.all("option")},_createOptionElements:function(q,o,p){var n=this;e.each(q,function(s,r,t){o[p+s.name]={groupId:s.groupId,layoutId:s.layoutId,name:s.name,privateLayout:s.privateLayout};if(s.hasChildren){n._createOptionElements(s.children.layouts,o,p+m+c)}})},_uiSetValue:function(q){var n=this;var o=n.options;if(o&&o.size()){o.set("selected",false);if(h.isValue(q)){var p=b.Util.parseJSON(q);o.each(function(t,r,u){var s=b.Util.parseJSON(t.attr("value"));if((s.groupId===p.groupId)&&(s.layoutId===p.layoutId)&&(s.privateLayout===p.privateLayout)){t.set("selected",true)}})}}return q}}});var b=f.Component.create({ATTRS:{portletNamespace:{validator:h.isString,value:j},recordsetId:{validator:h.isNumber,value:0},structure:{validator:h.isArray,value:[]}},CSS_PREFIX:"table",DATATYPE_VALIDATOR:{date:"date","double":"number",integer:"digits","long":"digits"},EXTENDS:f.DataTable,NAME:f.DataTable.Base.NAME,TYPE_EDITOR:{checkbox:f.CheckboxCellEditor,"ddm-date":f.DateCellEditor,"ddm-decimal":f.TextCellEditor,"ddm-integer":f.TextCellEditor,"ddm-number":f.TextCellEditor,radio:f.RadioCellEditor,select:f.DropDownCellEditor,text:f.TextCellEditor,textarea:f.TextAreaCellEditor},prototype:{initializer:function(){var n=this;n._setDataStableSort(n.get("data"));n.set("scrollable",true);n.on("dataChange",n._onDataChange);n.on("model:change",n._onRecordUpdate)},addEmptyRows:function(o){var n=this;var p=n.get("columns");var r=n.get("data");var q=e.map(p,function(t,s,u){return t.key});r.add(b.buildEmptyRecords(o,q))},updateMinDisplayRows:function(p,q){var n=this;q=(q&&f.bind(q,n))||d;var o=n.get("recordsetId");Liferay.Service("/ddlrecordset/update-min-display-rows",{recordSetId:o,minDisplayRows:p,serviceContext:l.stringify({scopeGroupId:themeDisplay.getScopeGroupId(),userId:themeDisplay.getUserId()})},q)},_afterActiveCellIndexChange:function(n){var y=this;var t=y.get("activeCell");var u=y.get("boundingBox");var s=u.one(".table-x-scroller");var w=y.highlight.get("activeBorderWidth")[0];var r=t.outerWidth()+w;var o=s.outerWidth();var x=t.get("offsetLeft");var q=s.get("scrollLeft");var p=x+r;var v=q;if((q+o)<p){v=p-o}else{if(x<q){v=x}}s.set("scrollLeft",v)},_normalizeRecordData:function(p){var n=this;var o=n.get("structure");var q={};f.each(o,function(t,r,v){var s=t.type;var u=p.get(t.name);if(s==="ddm-link-to-page"){u=b.Util.parseJSON(u);delete u.name;u=l.stringify(u)}else{if((s==="radio")||(s==="select")){if(!h.isArray(u)){u=e(u)}u=l.stringify(u)}}q[t.name]=n._normalizeValue(u)});delete q.displayIndex;delete q.recordId;return q},_normalizeValue:function(o){var n=this;return String(o)},_onDataChange:function(o){var n=this;n._setDataStableSort(o.newVal)},_onEditCell:function(n){var w=this;b.superclass._onEditCell.apply(w,arguments);var s=w.get("activeCell");var o=n.alignNode||s;var r=w.getColumn(o);var u=w.getRecord(o);var t=w.get("data");var p=w.get("recordsetId");var q=w.get("structure");var v=w.getEditor(u,r);if(v){v.setAttrs({data:t,record:u,recordsetId:p,structure:q,zIndex:Liferay.zIndex.OVERLAY})}},_onRecordUpdate:function(s){var n=this;if(!f.Object.owns(s.changed,"recordId")){var t=n.get("data");var r=n.get("recordsetId");var o=s.target;var q=o.get("recordId");var u=n._normalizeRecordData(o);var p=t.indexOf(o);if(q>0){b.updateRecord(q,p,u,true)}else{b.addRecord(r,p,u,function(v){if(v.recordId>0){o.set("recordId",v.recordId,{silent:true})}})}}},_setDataStableSort:function(o){var n=this;o.sort=function(p){if(this.comparator){p=p||{};var r=this._items.concat();f.ArraySort.stableSort(r,f.bind(this._sort,this));var q=f.merge(p,{models:r,src:"sort"});if(p.silent){this._defResetFn(q)}else{this.fire("reset",q)}}return this}}},addRecord:function(p,o,r,q){var n=this;q=(q&&f.bind(q,n))||d;Liferay.Service("/ddlrecord/add-record",{groupId:themeDisplay.getScopeGroupId(),recordSetId:p,displayIndex:o,fieldsMap:l.stringify(r),serviceContext:l.stringify({scopeGroupId:themeDisplay.getScopeGroupId(),userId:themeDisplay.getUserId(),workflowAction:Liferay.Workflow.ACTION_PUBLISH})},q)},buildDataTableColumns:function(q,o,p){var n=this;e.each(q,function(C,w,v){var B=C.dataType;var A=C.label;var r=C.name;var y=C.type;C.key=r;var D=n.TYPE_EDITOR[y]||f.TextCellEditor;var s={elementName:r,validator:{rules:{}}};var x=C.required;var z;if(x){A+=" ("+'\u002a'+")"}A=f.Escape.html(A);C.label=A;if(y==="checkbox"){s.options={"true":'\u0056\u0065\u0072\u006f'};s.inputFormatter=function(G){return String(G.length>0)};C.formatter=function(I){var H=I.data;var G=H[r];if(G==="true"){G='\u0056\u0065\u0072\u006f'}else{if(G==="false"){G='\u0046\u0061\u006c\u0073\u006f'}}return G}}else{if(y==="ddm-date"){s.inputFormatter=function(G){return e.map(G,function(I,H,J){return I.getTime()})};s.outputFormatter=function(G){return e.map(G,function(J,I,K){var H=new Date(h.toInt(J));H=g.add(H,g.MINUTES,H.getTimezoneOffset());return H})};C.formatter=function(J){var I=J.data;var H=I[r];if(H!==j){var G=new Date(h.toInt(H));G=g.add(G,g.MINUTES,G.getTimezoneOffset());H=f.DataType.Date.format(G)}return H}}else{if((y==="ddm-decimal")||(y==="ddm-integer")||(y==="ddm-number")){s.outputFormatter=function(H){var G=f.DataType.Number.parse(H);var I=j;if(h.isNumber(G)){I=G}return I};C.formatter=function(I){var H=I.data;var G=f.DataType.Number.parse(H[r]);if(!h.isNumber(G)){G=j}return G}}else{if(y==="ddm-documentlibrary"){C.formatter=function(K){var J=K.data;var H=j;var I=J[r];if(I!==j){var G=b.Util.parseJSON(I);if(G.title){H=G.title}}return H}}else{if(y==="ddm-link-to-page"){C.formatter=function(J){var I=J.data;var G=j;var H=I[r];if(H!==j){var K=b.Util.parseJSON(H);if(K.name){G=K.name}}return G}}else{if((y==="radio")||(y==="select")){z=n.findStructureFieldByAttribute(o,"name",r);var F=f.DataType.Boolean.parse(z.multiple);var E=n.getCellEditorOptions(z.options);C.formatter=function(J){var I=J.data;var G=[];var H=I[r];e.each(H,function(K,M,L){G.push(E[K])});return G.join(", ")};s.inputFormatter=e;s.multiple=F;s.options=E}}}}}}var u=n.DATATYPE_VALIDATOR[B];var t=s.validator.rules;t[r]=f.mix({required:x},t[r]);if(u){t[r][u]=true}if(p&&C.editable){C.editor=new D(s)}});return q},buildEmptyRecords:function(o,q){var n=this;var r=[];for(var p=0;p<o;p++){r.push(n.getRecordModel(q))}return r},findStructureFieldByAttribute:function(n,o,p){var q=null;e.some(n,function(s,r,t){q=s;return(q[o]===p)});return q},getCellEditorOptions:function(n){var o={};e.each(n,function(q,p,r){o[q.value]=q.label});return o},getRecordModel:function(p){var n=this;var o={};e.each(p,function(r,q,s){o[r]=j});return o},updateRecord:function(p,o,s,r,q){var n=this;q=(q&&f.bind(q,n))||d;Liferay.Service("/ddlrecord/update-record",{recordId:p,displayIndex:o,fieldsMap:l.stringify(s),mergeFields:r,serviceContext:l.stringify({scopeGroupId:themeDisplay.getScopeGroupId(),userId:themeDisplay.getUserId(),workflowAction:Liferay.Workflow.ACTION_PUBLISH})},q)}});b.Util={getFileEntry:function(o,p){var n=this;o=n.parseJSON(o);Liferay.Service("/dlapp/get-file-entry-by-uuid-and-group-id",{uuid:o.uuid,groupId:o.groupId},p)},getFileEntryURL:function(p){var n=this;var o=[themeDisplay.getPathContext(),"documents",p.groupId,p.folderId,encodeURIComponent(p.title)];return o.join("/")},parseJSON:function(p){var n=this;var o={};try{o=l.parse(p)}catch(q){}return o}};b.TYPE_EDITOR["ddm-documentlibrary"]=i;b.TYPE_EDITOR["ddm-link-to-page"]=k;Liferay.SpreadSheet=b;var a={previewDialog:null,openPreviewDialog:function(p){var n=this;var o=n.previewDialog;if(!o){o=Liferay.Util.Window.getWindow({dialog:{bodyContent:p},title:'\u0041\u006e\u0074\u0065\u0070\u0072\u0069\u006d\u0061'});n.previewDialog=o}else{o.show();o.set("bodyContent",p)}}};Liferay.DDLUtil=a},"",{requires:["aui-arraysort","aui-datatable","datatable-sort","json","liferay-portlet-url","liferay-util-window"]});